!function(l){l.fn.yiiActiveForm=function(t){return m[t]?m[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(l.error("Method "+t+" does not exist on jQuery.yiiActiveForm"),!1):m.init.apply(this,arguments)};function d(t){a&&(a.resolve(),a=void 0,t.removeData("yiiSubmitFinalizePromise"))}var a,e="beforeValidate",o="afterValidate",c="beforeValidateAttribute",v="afterValidateAttribute",n="beforeSubmit",f="ajaxBeforeSend",h="ajaxComplete",r="afterInit",s={encodeErrorSummary:!0,errorSummary:".error-summary",validateOnSubmit:!0,errorCssClass:"has-error",successCssClass:"has-success",validatingCssClass:"validating",ajaxParam:"ajax",ajaxDataType:"json",validationUrl:void 0,scrollToError:!0,scrollToErrorOffset:0,validationStateOn:"container"},u={id:void 0,name:void 0,container:void 0,input:void 0,error:".help-block",encodeError:!0,validateOnChange:!0,validateOnBlur:!0,validateOnType:!1,validationDelay:500,enableAjaxValidation:!1,validate:void 0,status:0,cancelled:!1,value:void 0,updateAriaInvalid:!0},m={init:function(a,n){return this.each(function(){var i=l(this);if(!i.data("yiiActiveForm")){var t=l.extend({},s,n||{});void 0===t.validationUrl&&(t.validationUrl=i.attr("action")),l.each(a,function(t){a[t]=l.extend({value:E(i,this)},u,this),g(i,a[t])}),i.data("yiiActiveForm",{settings:t,attributes:a,submitting:!1,validated:!1,options:O(i)}),i.on("reset.yiiActiveForm",m.resetForm),t.validateOnSubmit&&(i.on("mouseup.yiiActiveForm keyup.yiiActiveForm",":submit",function(){i.data("yiiActiveForm").submitObject=l(this)}),i.on("submit.yiiActiveForm",m.submitForm));var e=l.Event(r);i.trigger(e)}})},add:function(t){var i=l(this);t=l.extend({value:E(i,t)},u,t),i.data("yiiActiveForm").attributes.push(t),g(i,t)},remove:function(i){var t=l(this),e=t.data("yiiActiveForm").attributes,a=-1,n=void 0;return l.each(e,function(t){if(e[t].id==i)return n=e[a=t],!1}),0<=a&&(e.splice(a,1),y(t,n)),n},validateAttribute:function(t){var i=m.find.call(this,t);null!=i&&b(l(this),i,!0)},find:function(i){var e=l(this).data("yiiActiveForm").attributes,a=void 0;return l.each(e,function(t){if(e[t].id==i)return a=e[t],!1}),a},destroy:function(){return this.each(function(){l(this).off(".yiiActiveForm"),l(this).removeData("yiiActiveForm")})},data:function(){return this.data("yiiActiveForm")},validate:function(t){t&&(l(this).data("yiiActiveForm").submitting=!0);var a=l(this),n=a.data("yiiActiveForm"),r=!1,s={},o=F(),u=n.submitting;if(u){var i=l.Event(e);if(a.trigger(i,[s,o]),!1===i.result)return n.submitting=!1,void d(a)}l.each(n.attributes,function(){this.$form=a;var t=D(a,this);if(t.is(":disabled"))return!0;if(t.length&&"select"===t[0].tagName.toLowerCase()){if(!t[0].options.length)return!0;if(1===t[0].options.length&&""===t[0].options[0].value)return!0}if(this.cancelled=!1,n.submitting||2===this.status||3===this.status){var i=s[this.id];void 0===i&&(i=[],s[this.id]=i);var e=l.Event(c);a.trigger(e,[this,i,o]),!1!==e.result?(this.validate&&this.validate(this,E(a,this),i,o,a),this.enableAjaxValidation&&(r=!0)):this.cancelled=!0}}),l.when.apply(this,o).always(function(){for(var t in s)0===s[t].length&&delete s[t];if(r&&(l.isEmptyObject(s)||n.submitting)){var i=n.submitObject,e="&"+n.settings.ajaxParam+"="+a.attr("id");i&&i.length&&i.attr("name")&&(e+="&"+i.attr("name")+"="+i.attr("value")),l.ajax({url:n.settings.validationUrl,type:a.attr("method"),data:a.serialize()+e,dataType:n.settings.ajaxDataType,complete:function(t,i){a.trigger(h,[t,i])},beforeSend:function(t,i){a.trigger(f,[t,i])},success:function(t){null!==t&&"object"==typeof t?(l.each(n.attributes,function(){this.enableAjaxValidation&&!this.cancelled||delete t[this.id]}),w(a,l.extend(s,t),u)):w(a,s,u)},error:function(){n.submitting=!1,d(a)}})}else n.submitting?window.setTimeout(function(){w(a,s,u)},200):w(a,s,u)})},submitForm:function(){var t=l(this),i=t.data("yiiActiveForm");if(i.validated){i.submitting=!1;var e=l.Event(n);return t.trigger(e),!1===e.result?(i.validated=!1,d(t),!1):(x(t),!0)}return function(t){a=l.Deferred(),t.data("yiiSubmitFinalizePromise",a.promise())}(t),void 0!==i.settings.timer&&clearTimeout(i.settings.timer),i.submitting=!0,m.validate.call(t),!1},resetForm:function(){var e=l(this),a=e.data("yiiActiveForm");window.setTimeout(function(){l.each(a.attributes,function(){this.value=E(e,this),this.status=0;var t=e.find(this.container),i=D(e,this);("input"===a.settings.validationStateOn?i:t).removeClass(a.settings.validatingCssClass+" "+a.settings.errorCssClass+" "+a.settings.successCssClass),t.find(this.error).html("")}),e.find(a.settings.errorSummary).hide().find("ul").html("")},1)},updateMessages:function(t,i){var e=l(this),a=e.data("yiiActiveForm");l.each(a.attributes,function(){T(e,this,t)}),i&&S(e,t)},updateAttribute:function(t,i){var e=m.find.call(this,t);if(null!=e){var a={};a[t]=i,T(l(this),e,a)}}},g=function(i,e){var t=D(i,e);e.validateOnChange&&t.on("change.yiiActiveForm",function(){b(i,e,!1)}),e.validateOnBlur&&t.on("blur.yiiActiveForm",function(){0!=e.status&&1!=e.status||b(i,e,!0)}),e.validateOnType&&t.on("keyup.yiiActiveForm",function(t){-1===l.inArray(t.which,[16,17,18,37,38,39,40])&&e.value!==E(i,e)&&b(i,e,!1,e.validationDelay)})},y=function(t,i){D(t,i).off(".yiiActiveForm")},b=function(t,i,e,a){var n=t.data("yiiActiveForm");e&&(i.status=2),l.each(n.attributes,function(){p(this.value,E(t,this))||(this.status=2,e=!0)}),e&&(void 0!==n.settings.timer&&clearTimeout(n.settings.timer),n.settings.timer=window.setTimeout(function(){n.submitting||t.is(":hidden")||(l.each(n.attributes,function(){2===this.status&&(this.status=3,t.find(this.container).addClass(n.settings.validatingCssClass))}),m.validate.call(t))},a||200))},p=function(t,i){return t instanceof Object?A(t,i):Array.isArray(t)?C(t,i):t===i},A=function(t,i){if(!(t instanceof Object&&i instanceof Object))return!1;var e=Object.keys(t),a=Object.keys(i);if(e.length!==a.length)return!1;for(var n=0;n<e.length;n+=1){if(!i.hasOwnProperty(e[n]))return!1;if(t[e[n]]!==i[e[n]])return!1}return!0},C=function(t,i){if(!Array.isArray(t)||!Array.isArray(i))return!1;if(t.length!==i.length)return!1;for(var e=0;e<t.length;e+=1)if(t[e]!==i[e])return!1;return!0},F=function(){var t=[];return t.add=function(t){this.push(new l.Deferred(t))},t},j=["action","target","method","enctype"],O=function(t){for(var i={},e=0;e<j.length;e++)i[j[e]]=t.attr(j[e]);return i},w=function(t,i,e){var a=t.data("yiiActiveForm");if(void 0===a)return!1;if(e){var n=[];if(l.each(a.attributes,function(){D(t,this).is(":disabled")||this.cancelled||!T(t,this,i)||n.push(this)}),t.trigger(o,[i,n]),S(t,i),n.length){if(a.settings.scrollToError){var r=t.find(l.map(n,function(t){return t.input}).join(",")).first().closest(":visible").offset().top-a.settings.scrollToErrorOffset;r<0?r=0:r>l(document).height()&&(r=l(document).height());var s=l(window).scrollTop();(r<s||r>s+l(window).height())&&l(window).scrollTop(r)}a.submitting=!1}else a.validated=!0,a.submitObject&&function(t,i){for(var e=0;e<j.length;e++){var a=i.attr("form"+j[e]);a&&t.attr(j[e],a)}}(t,a.submitObject),t.submit(),a.submitObject&&function(t){for(var i=t.data("yiiActiveForm"),e=0;e<j.length;e++)t.attr(j[e],i.options[j[e]]||null)}(t)}else l.each(a.attributes,function(){this.cancelled||2!==this.status&&3!==this.status||T(t,this,i)});d(t)},x=function(t){var i=t.data("yiiActiveForm").submitObject||t.find(":submit:first");if(i.length&&"submit"==i.attr("type")&&i.attr("name")){var e=l('input[type="hidden"][name="'+i.attr("name")+'"]',t);e.length?e.attr("value",i.attr("value")):l("<input>").attr({type:"hidden",name:i.attr("name"),value:i.attr("value")}).appendTo(t)}},T=function(t,i,e){var a=t.data("yiiActiveForm"),n=D(t,i),r=!1;if(l.isArray(e[i.id])||(e[i.id]=[]),i.status=1,n.length){r=0<e[i.id].length;var s=t.find(i.container),o=s.find(i.error);k(t,i,r);var u="input"===a.settings.validationStateOn?n:s;r?(i.encodeError?o.text(e[i.id][0]):o.html(e[i.id][0]),u.removeClass(a.settings.validatingCssClass+" "+a.settings.successCssClass).addClass(a.settings.errorCssClass)):(o.empty(),u.removeClass(a.settings.validatingCssClass+" "+a.settings.errorCssClass+" ").addClass(a.settings.successCssClass)),i.value=E(t,i)}return t.trigger(v,[i,e[i.id]]),r},S=function(t,i){var e=t.data("yiiActiveForm"),a=t.find(e.settings.errorSummary),n=a.find("ul").empty();a.length&&i&&(l.each(e.attributes,function(){if(l.isArray(i[this.id])&&i[this.id].length){var t=l("<li/>");e.settings.encodeErrorSummary?t.text(i[this.id][0]):t.html(i[this.id][0]),n.append(t)}}),a.toggle(0<n.find("li").length))},E=function(t,i){var e=D(t,i),a=e.attr("type");if("checkbox"!==a&&"radio"!==a)return e.val();var n=e.filter(":checked");return n.length||(n=t.find('input[type=hidden][name="'+e.attr("name")+'"]')),n.val()},D=function(t,i){var e=t.find(i.input);return e.length&&"div"===e[0].tagName.toLowerCase()?e.find("input"):e},k=function(t,i,e){i.updateAriaInvalid&&t.find(i.input).attr("aria-invalid",e?"true":"false")}}(window.jQuery);